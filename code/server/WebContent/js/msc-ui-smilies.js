(function(c,d,a){var b=a.ui.smilies=function(e,g){var f=b._dom;if(!d.isPlainObject(e)){e={target:e,callback:g};}b.config=e;e.target=d(e.target);if(!e.target.length){return b;}if(b._loaded&&e.target[0]===f.target[0]){if(b._visible){b.hide();return b;}}f.target=e.target;if(!b._loaded){b._loaded=1;f.box=d('<div class="ui_smilies"></div>').appendTo(document.body);d.getScript("//static.meishichina.com/v6/js/lib/msc-ui-smilies-data.js?v=20140401");}b._visible=1;b._bind();a.event.resize.trigger("smilies");setTimeout(function(){b.show();},100);return b;};b._data={};b._dom={};b._dataLength=0;b.hide=function(){b._visible=0;b._dom.box.hide();return b;};b.show=function(){b._visible=1;b._dom.box.show();return b;};b._position=function(m){if(b._visible){var n=b._dom,k=n.target.offset(),g=k.left,o=k.top,q=n.target.outerHeight(true),e=n.target.outerWidth(true),h=402,j=162,l=m.scrollTop,p=m.scrollLeft,f=m.width,i=m.height;if(g<0){g=0;}if(g+h>=f+p&&g+e-p>=h){g=g+e-h;}else{if(g+h>=f+p){g=p+f-h;}}if(o+q+j>=i+l){o=o-j;}else{o=o+q;}n.box.css({left:g,top:o});n=k=g=o=q=e=h=j=l=p=f=i=null;}};b.addItem=function(e,f){if(!b._data[e.name]){b._dataLength++;b._data[e.name]={};b._data[e.name].data=f;b._data[e.name].path=e.path||"";}return b.update(e.name);};b._bind=function(){d(document).on("click",function(){b.hide();});b._dom.box.on("click",function(f){f.stopPropagation();});b._dom.box.on("click","img",function(f){if(b.config.callback){f.stopPropagation();b.config.callback.call(this,this.title,this.src);b.hide();}});a.event.resize.add("smilies",b._position);b._bind=d.noop;};b.update=function(f){var i=b._dom.box,g=b._data,j,h,e;i[0].className="ui-smilies";i.empty();if(b._dataLength===0){i[0].innerHTML='<div class="ui-smilies-no">什么? 刷新失败了, <a href="javascript:;" onclick="msc.ui.smilies.update();">刷新</a> 再试试吧!</div>';}else{if(b._dataLength<2){j='<div class="ui-smilies-content"><ul>';for(h in g){for(e in g[h].data){j+='<li><img src="'+g[h].path+g[h].data[e]+'" title="'+e+'"></li>';}}i[0].innerHTML=j+"</ul></div";i[0].className+=" ui-smilies-noNav";}else{j='<ul class="ui-smilies-nav">';for(h in g){j+="<li>"+h+"</li>";}j+='</ul><div class="ui-smilies-content"></div>';i.html(j).find(".ui-smilies-nav").on("click","li",function(m){var l=b._data[this.innerHTML],n;m.stopPropagation();if(this.className==="on"){return;}d(this).addClass("on").siblings().removeClass("on");if(!l){n='<div class="ui-smilies-no">亲? 加载失败了, <a href="javascript:;" onclick="msc.ui.smilies.update()">重试</a></div>';}else{n="<ul>";for(var k in l.data){n+='<li><img src="'+l.path+l.data[k]+'" title="'+k+'"></li>';}n+="</ul>";}b._dom.box.find(".ui-smilies-content")[0].innerHTML=n;n=l=null;}).find("li").filter(function(k){return f?(this.innerHTML===f):(k===0);}).click();i=g=j=h=e=null;}}return b;};}(window,jQuery,msc));